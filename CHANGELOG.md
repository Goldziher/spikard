# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [0.1.0] - 2025-11-23

### Added

#### Core Framework (Rust)
- High-performance HTTP framework built on Axum and Tower-HTTP
- Type-safe routing with path parameter extraction
- JSON Schema validation via schemars
- RequestContext API for accessing request data (body, query, path params, headers, cookies)
- WebSocket support with trait-based handler abstraction
- Server-Sent Events (SSE) support with event producer pattern
- File upload handling with UploadFile type
- Streaming response support
- Testing utilities with in-memory TestServer
- Integration with custom Axum routers via `merge_axum_router`

#### Middleware Stack (Tower-HTTP)
- Compression middleware (gzip, brotli) with configurable quality and thresholds
- Rate limiting with per-second and burst controls
- Request timeout handling
- Request ID generation and tracking
- JWT authentication with multiple algorithm support (HS256, HS384, HS512, RS256)
- Static file serving with cache control and index file support
- CORS configuration
- Graceful shutdown handling

#### Lifecycle Hooks
- Zero-cost lifecycle hook system with Option<Arc<dyn Fn>> design
- Hook stages: `on_request`, `pre_validation`, `pre_handler`, `on_response`, `on_error`
- Support for short-circuiting with early responses
- Async hook support across all language bindings

#### OpenAPI Support
- Automatic OpenAPI 3.1 schema generation from route definitions
- Swagger UI integration at configurable path
- ReDoc integration at configurable path
- Schema extraction from schemars types and raw JSON schemas

#### Python Bindings (PyO3)
- FastAPI/Litestar-style decorator API (`@app.get`, `@post`, etc.)
- Standalone decorators (`@get`, `@post`, etc.)
- Path parameter extraction with type conversion
- Query parameter support with `Query` helper
- Request body validation with multiple backends:
  - msgspec.Struct (recommended, zero-copy, fastest)
  - Pydantic v2 BaseModel
  - dataclasses
  - TypedDict
  - NamedTuple
  - attrs classes
  - Raw JSON Schema dicts
- WebSocket support via `@websocket` decorator with async function handlers
- SSE support via `@sse` decorator with async generator pattern
- Background task execution with `background.run()`
- Custom response objects (Response, StreamingResponse)
- File upload handling with async `UploadFile.aread()`
- TestClient for integration testing with WebSocket and SSE support
- Zero-copy JSON-to-Python conversion via direct PyO3 type construction
- Async/await support via pyo3_async_runtimes
- Full type hints with mypy --strict compliance

#### Node.js Bindings (napi-rs)
- Manual route registration via `app.addRoute(metadata, handler)`
- Route metadata decorators for type safety
- Zod schema validation support
- Raw JSON Schema support
- Handler wrappers (`wrapHandler`, `wrapBodyHandler`) for parameter extraction
- Request context with query, path params, headers, form data
- File upload support with UploadFile type
- Streaming responses with async generators
- Lifecycle hooks with async callbacks
- Background task support
- TestClient with WebSocket and SSE testing utilities
- Full TypeScript type definitions generated by napi-rs
- Zero-copy FFI via ThreadsafeFunction for async JavaScript callbacks

#### Ruby Bindings (magnus)
- Sinatra-style block-based routing (`app.get`, `app.post`, etc.)
- Single request hash argument with unified interface
- Request hash structure with `:method`, `:path`, `:path_params`, `:query`, `:headers`, `:cookies`, `:body`, `:params`
- dry-schema validation support
- dry-struct validation support
- Raw JSON Schema support
- WebSocket support with class-based handlers
- SSE support with event producer classes
- Streaming responses with Enumerator
- Background task execution with `Spikard::Background.run`
- TestClient with WebSocket and SSE support
- RBS type definitions for type checking with Steep
- File upload handling with UploadFile

#### WebAssembly Bindings
- wasm-bindgen integration for browser and server-side WASM
- wasm-pack bundling support
- Optimized binary size with tree-shaking
- JavaScript/TypeScript interop with proper type safety

#### Testing Infrastructure
- Fixture-driven testing strategy with 400+ JSON fixtures
- Centralized `testing_data/` directory with categorized fixtures:
  - `headers/` - HTTP header validation scenarios
  - `cookies/` - Cookie handling scenarios
  - `json_bodies/` - Request body validation
  - `validation_errors/` - Error response formats
  - `status_codes/` - HTTP status code scenarios
  - `edge_cases/` - Edge case coverage
  - `cors/` - CORS configuration scenarios
- Schema validation for all fixture directories
- Parametrized pytest suites for comprehensive coverage
- 95% minimum Rust coverage (tarpaulin)
- 80%+ minimum coverage for Python/Node/Ruby bindings

#### Build & Automation
- Taskfile.yaml for cross-language build orchestration
- Task commands: `setup`, `build`, `test`, `lint`, `format`, `update`
- Language-specific tasks: `rust:build`, `python:build`, `node:build`, `ruby:build`, `wasm:build`
- Multi-language testing: `test:rust`, `test:python`, `test:node`, `test:ruby`
- Dependency management with committed lock files (Cargo.lock, uv.lock, pnpm-lock.yaml, Gemfile.lock)

#### Documentation
- Architecture Decision Records (ADRs) in `docs/adr/`:
  - 0001: Architecture and layering
  - 0002: Tower-HTTP middleware and configuration
  - 0003: Validation and fixtures strategy
  - 0005: Lifecycle hooks design
  - 0006: Async and streaming support
- Language-specific READMEs for Rust, Python, Node, Ruby
- Runnable examples in `examples/` for all language bindings
- Comprehensive API documentation with rustdoc, Python docstrings, JSDoc, RBS

### Changed
- N/A (initial release)

### Deprecated
- N/A (initial release)

### Removed
- N/A (initial release)

### Fixed

#### Documentation Corrections
- **Ruby README**: Fixed catastrophic handler signature errors (70% of examples incorrect)
  - Corrected from `|params, query, body|` to single `|request|` hash argument
  - Added comprehensive "Request Hash Structure" documentation
- **Node README**: Fixed Quick Start example showing non-existent auto-registration
  - Corrected to use manual `app.addRoute(metadata, handler)` pattern
  - Clarified that decorators only add metadata, don't auto-register
- **Python README**: Fixed 7 critical API mismatches
  - WebSocket: Changed from class-based to decorator-based async function
  - SSE: Changed from class with `next_event()` to async generator pattern
  - Background tasks: Fixed to use awaitable coroutine, not lambda
  - TestClient WebSocket: Corrected method names to `send()`/`recv()`
  - UploadFile: Added async `aread()` example
  - OpenApiConfig: Fixed import path to `from spikard.config`
  - SSE testing: Corrected event iteration pattern
- **Rust README**: Fixed 3 type errors in configuration examples
  - `StaticFilesConfig.index_file`: Corrected from `Option<bool>` to `bool`
  - `OpenApiConfig` paths: Corrected from `Option<String>` to `String`
  - Trait implementations: Fixed syntax from `async fn` to `-> impl Future`

### Security
- JWT validation with configurable algorithms and claims verification
- Secure cookie defaults (HttpOnly, Secure, SameSite) in Ruby bindings
- Header and cookie validation against fixture-based schemas
- Input validation at system boundaries (user input, external APIs)
- CORS middleware with configurable allowed origins, methods, headers

### Known Limitations
- PHP bindings planned but not yet implemented (ext-php-rs integration pending)
- OpenAPI documentation generation requires schemars types (raw JSON schemas supported but don't contribute to OpenAPI)
- WebAssembly bindings have limited threading support due to WASM runtime constraints
- Background tasks in Python require explicit awaitable coroutines (no automatic lambda wrapping)

## [Unreleased]

### Planned
- PHP bindings via ext-php-rs
- Enhanced OpenAPI customization options
- GraphQL support
- Additional middleware: CSRF protection, session management
- Performance benchmarks and comparison documentation
- Official package registry releases (crates.io, PyPI, npm, RubyGems)

---

[0.1.0]: https://github.com/yourusername/spikard/releases/tag/v0.1.0
