{
	"$schema": "http://json-schema.org/draft-07/schema#",
	"title": "Compression Middleware Test Fixture",
	"description": "Schema for compression middleware test fixtures covering tower-http CompressionLayer with gzip, brotli, deflate, and content negotiation via Accept-Encoding header",
	"type": "object",
	"required": ["name", "description", "category", "source", "request", "expected_response", "handler"],
	"properties": {
		"name": {
			"type": "string",
			"description": "Human-readable test case name",
			"minLength": 1
		},
		"description": {
			"type": "string",
			"description": "What this test validates",
			"minLength": 1
		},
		"category": {
			"type": "string",
			"enum": ["compression"],
			"description": "Test category"
		},
		"source": {
			"type": "object",
			"description": "Source framework and test location",
			"required": ["framework"],
			"properties": {
				"framework": {
					"type": "string",
					"description": "Source framework"
				},
				"inspired_by": {
					"type": "string",
					"description": "Framework or library that inspired this test"
				},
				"test_case": {
					"type": "string",
					"description": "Test case description"
				}
			}
		},
		"handler": {
			"type": "object",
			"description": "Handler configuration including middleware",
			"required": ["route", "method"],
			"properties": {
				"route": {
					"type": "string",
					"description": "API route path"
				},
				"method": {
					"type": "string",
					"enum": ["GET", "POST", "PUT", "PATCH", "DELETE"],
					"description": "HTTP method"
				},
				"middleware": {
					"type": "object",
					"description": "Middleware configuration",
					"properties": {
						"compression": {
							"oneOf": [
								{
									"type": "null",
									"description": "Compression disabled"
								},
								{
									"type": "object",
									"description": "Compression middleware config using tower_http::compression::CompressionLayer",
									"properties": {
										"enabled": {
											"type": "boolean",
											"description": "Whether compression is enabled",
											"default": true
										},
										"algorithms": {
											"type": "array",
											"description": "Supported compression algorithms in preference order",
											"items": {
												"type": "string",
												"enum": ["gzip", "br", "deflate", "zstd"]
											},
											"default": ["gzip", "br", "deflate"]
										},
										"level": {
											"type": "integer",
											"description": "Compression level (1-9 for gzip, 0-11 for brotli). Higher = better compression, slower",
											"minimum": 0,
											"maximum": 11,
											"default": 6
										},
										"min_size_bytes": {
											"type": "integer",
											"description": "Minimum response size in bytes before compression is applied",
											"minimum": 0,
											"default": 1024
										},
										"skip_content_types": {
											"type": "array",
											"description": "Content types to skip compression (already compressed formats)",
											"items": { "type": "string" },
											"default": ["image/", "video/", "audio/", "application/zip", "application/gzip"]
										}
									}
								}
							]
						}
					}
				},
				"response_body_size": {
					"type": "integer",
					"description": "Simulated uncompressed response body size in bytes",
					"minimum": 0
				}
			}
		},
		"request": {
			"type": "object",
			"description": "HTTP request details",
			"required": ["method", "path"],
			"properties": {
				"method": {
					"type": "string",
					"enum": ["GET", "POST", "PUT", "PATCH", "DELETE", "HEAD", "OPTIONS"],
					"description": "HTTP method"
				},
				"path": {
					"type": "string",
					"description": "Request path",
					"minLength": 1
				},
				"headers": {
					"type": "object",
					"description": "Request headers as key-value pairs",
					"additionalProperties": { "type": "string" },
					"properties": {
						"Accept-Encoding": {
							"type": "string",
							"description": "Client's supported compression algorithms with optional quality values"
						}
					}
				},
				"body": {
					"description": "Request body (any JSON type)"
				}
			}
		},
		"expected_response": {
			"type": "object",
			"description": "Expected HTTP response",
			"required": ["status_code"],
			"properties": {
				"status_code": {
					"type": "integer",
					"description": "Expected HTTP status code",
					"minimum": 100,
					"maximum": 599
				},
				"body": {
					"description": "Expected response body (any JSON type)"
				},
				"headers": {
					"type": "object",
					"description": "Expected response headers",
					"additionalProperties": { "type": "string" },
					"properties": {
						"Content-Encoding": {
							"oneOf": [
								{
									"type": "string",
									"enum": ["gzip", "br", "deflate", "identity"],
									"description": "Applied compression algorithm"
								},
								{
									"type": "null",
									"description": "No compression applied"
								}
							]
						},
						"Vary": {
							"type": "string",
							"description": "Cache control header indicating compression negotiation",
							"pattern": "Accept-Encoding"
						}
					}
				},
				"compression_metrics": {
					"type": "object",
					"description": "Metrics about compression efficiency",
					"properties": {
						"uncompressed_size_bytes": {
							"type": "integer",
							"description": "Original response size in bytes",
							"minimum": 0
						},
						"compressed_size_bytes": {
							"type": "integer",
							"description": "Compressed response size in bytes",
							"minimum": 0
						},
						"compression_ratio": {
							"type": "number",
							"description": "Ratio of uncompressed to compressed size",
							"minimum": 1.0
						}
					}
				}
			}
		},
		"tags": {
			"type": "array",
			"description": "Tags for categorizing and filtering tests",
			"items": { "type": "string" }
		},
		"notes": {
			"type": "string",
			"description": "Additional notes about this test case, implementation details, or references to tower-http::compression"
		}
	}
}
