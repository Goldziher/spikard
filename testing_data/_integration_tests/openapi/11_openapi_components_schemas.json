{
	"name": "OpenAPI with reusable component schemas",
	"description": "Tests OpenAPI spec generation with reusable schemas in components section",
	"category": "openapi",
	"source": {
		"framework": "spikard",
		"test_case": "components and schemas"
	},
	"handler": {
		"route": "/api/posts",
		"method": "POST",
		"request_schema": {
			"$ref": "#/components/schemas/CreatePost"
		},
		"response_schema": {
			"$ref": "#/components/schemas/Post"
		},
		"middleware": {
			"openapi": {
				"enabled": true,
				"title": "Component Schema API",
				"version": "1.0.0",
				"description": "API with reusable component schemas",
				"components": {
					"schemas": {
						"User": {
							"type": "object",
							"required": ["id", "username"],
							"properties": {
								"id": {
									"type": "integer",
									"format": "int64"
								},
								"username": {
									"type": "string",
									"minLength": 3,
									"maxLength": 50
								},
								"email": {
									"type": "string",
									"format": "email"
								}
							}
						},
						"CreatePost": {
							"type": "object",
							"required": ["title", "content"],
							"properties": {
								"title": {
									"type": "string",
									"minLength": 1,
									"maxLength": 200
								},
								"content": {
									"type": "string"
								},
								"tags": {
									"type": "array",
									"items": {
										"type": "string"
									}
								}
							}
						},
						"Post": {
							"type": "object",
							"required": ["id", "title", "content", "author"],
							"properties": {
								"id": {
									"type": "integer",
									"format": "int64"
								},
								"title": {
									"type": "string"
								},
								"content": {
									"type": "string"
								},
								"author": {
									"$ref": "#/components/schemas/User"
								},
								"tags": {
									"type": "array",
									"items": {
										"type": "string"
									}
								},
								"created_at": {
									"type": "string",
									"format": "date-time"
								}
							}
						}
					}
				}
			}
		}
	},
	"request": {
		"method": "GET",
		"path": "/openapi.json",
		"headers": {
			"accept": "application/json"
		}
	},
	"expected_response": {
		"status_code": 200,
		"headers": {
			"content-type": "application/json"
		},
		"body_partial": {
			"openapi": "3.1.0",
			"info": {
				"title": "Component Schema API",
				"version": "1.0.0"
			},
			"components": {
				"schemas": {
					"User": {
						"type": "object",
						"required": ["id", "username"],
						"properties": {
							"id": {
								"type": "integer"
							},
							"username": {
								"type": "string"
							}
						}
					},
					"CreatePost": {
						"type": "object",
						"required": ["title", "content"]
					},
					"Post": {
						"type": "object",
						"required": ["id", "title", "content", "author"],
						"properties": {
							"author": {
								"$ref": "#/components/schemas/User"
							}
						}
					}
				}
			}
		}
	},
	"tags": ["openapi", "components", "schemas", "reusability", "refs"],
	"notes": "Component schemas enable DRY principle and improve spec readability. $ref syntax links to shared schemas."
}
