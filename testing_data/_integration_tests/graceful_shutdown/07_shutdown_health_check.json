{
	"name": "Health check endpoint returns unhealthy during shutdown",
	"description": "Tests that health check endpoint returns shutting_down status and 503 during graceful shutdown",
	"category": "graceful_shutdown",
	"source": {
		"framework": "spikard",
		"inspired_by": "axum_graceful_shutdown",
		"test_case": "health check during shutdown"
	},
	"handler": {
		"route": "/health",
		"method": "GET",
		"middleware": {
			"graceful_shutdown": {
				"enabled": true,
				"grace_period_seconds": 30,
				"force_timeout_seconds": 60
			}
		}
	},
	"test_scenario": {
		"phases": [
			{
				"phase": "verify_healthy_before_shutdown",
				"description": "Verify health check returns healthy status before shutdown",
				"actions": [
					{
						"type": "request",
						"request": {
							"method": "GET",
							"path": "/health",
							"headers": {
								"Accept": "application/json"
							}
						},
						"expected_response": {
							"status_code": 200,
							"headers": {
								"Content-Type": "application/json"
							},
							"body": {
								"status": "healthy",
								"accepting_connections": true,
								"shutting_down": false
							}
						}
					}
				]
			},
			{
				"phase": "trigger_shutdown",
				"description": "Send shutdown signal",
				"actions": [
					{
						"type": "signal",
						"signal": "SIGTERM"
					}
				]
			},
			{
				"phase": "verify_unhealthy_during_shutdown",
				"description": "Verify health check returns shutting_down status during graceful shutdown",
				"delay_ms": 100,
				"actions": [
					{
						"type": "request",
						"request": {
							"method": "GET",
							"path": "/health",
							"headers": {
								"Accept": "application/json"
							}
						},
						"expected_response": {
							"status_code": 503,
							"headers": {
								"Content-Type": "application/json"
							},
							"body": {
								"status": "shutting_down",
								"accepting_connections": false,
								"shutting_down": true,
								"grace_period_seconds": 30,
								"message": "Server is shutting down gracefully"
							}
						}
					}
				]
			}
		]
	},
	"tags": ["graceful_shutdown", "integration", "lifecycle", "health-check", "monitoring"],
	"notes": "Health check endpoint should reflect shutdown state so load balancers can drain traffic. Returns 503 to signal unhealthy state."
}
