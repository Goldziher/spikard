name: Comparative Benchmarks

on:
  workflow_dispatch:
    inputs:
      suite:
        description: 'Workload suite to run'
        required: false
        default: 'all'
        type: choice
        options:
          - all
          - json-bodies
          - path-params
          - query-params
          - forms
          - multipart
          - streaming
      duration:
        description: 'Duration per workload (seconds)'
        required: false
        default: '30'
        type: string
      concurrency:
        description: 'Concurrent connections'
        required: false
        default: '100'
        type: string

concurrency:
  group: benchmarks-${{ github.ref }}
  cancel-in-progress: true

env:
  RUST_BACKTRACE: short
  CARGO_TERM_COLOR: always
  CARGO_INCREMENTAL: 0
  CARGO_PROFILE_RELEASE_DEBUG: 0

jobs:
  build-harness:
    name: Build Benchmark Harness
    runs-on: ubuntu-latest
    timeout-minutes: 15
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6

      - name: Setup Rust
        uses: ./.github/actions/setup-rust
        with:
          cache-key-prefix: benchmark-harness

      - name: Build benchmark harness
        run: cargo build --manifest-path tools/benchmark-harness/Cargo.toml --release

      - name: Upload benchmark harness
        uses: actions/upload-artifact@v6
        with:
          name: benchmark-harness
          path: target/release/benchmark-harness
          retention-days: 1

  bench-spikard-rust-validation:
    name: spikard-rust-validation
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: spikard-rust-validation
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-spikard-rust-raw:
    name: spikard-rust-raw
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: spikard-rust-raw
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-spikard-python-validation:
    name: spikard-python-validation
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: spikard-python-validation
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-spikard-python-raw:
    name: spikard-python-raw
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: spikard-python-raw
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-spikard-node-validation:
    name: spikard-node-validation
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: spikard-node-validation
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-spikard-bun-validation:
    name: spikard-bun-validation
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: spikard-bun-validation
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-spikard-node-raw:
    name: spikard-node-raw
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: spikard-node-raw
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-spikard-bun-raw:
    name: spikard-bun-raw
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: spikard-bun-raw
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-spikard-ruby-validation:
    name: spikard-ruby-validation
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: spikard-ruby-validation
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-spikard-ruby-raw:
    name: spikard-ruby-raw
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: spikard-ruby-raw
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-spikard-wasm-validation:
    name: spikard-wasm-validation
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: spikard-wasm-validation
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-spikard-wasm-raw:
    name: spikard-wasm-raw
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: spikard-wasm-raw
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-fastapi-uvicorn-validation:
    name: fastapi-uvicorn-validation
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: fastapi-uvicorn-validation
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-fastapi-granian-validation:
    name: fastapi-granian-validation
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: fastapi-granian-validation
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-fastapi-uvicorn-raw:
    name: fastapi-uvicorn-raw
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: fastapi-uvicorn-raw
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-fastapi-granian-raw:
    name: fastapi-granian-raw
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: fastapi-granian-raw
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-robyn-raw:
    name: robyn-raw
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: robyn-raw
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-fastify-validation:
    name: fastify-validation
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: fastify-validation
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-fastify-raw:
    name: fastify-raw
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: fastify-raw
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-hono-validation:
    name: hono-validation
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: hono-validation
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-elysia-validation:
    name: elysia-validation
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: elysia-validation
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-hono-raw:
    name: hono-raw
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: hono-raw
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-express-validation:
    name: express-validation
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: express-validation
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-express-raw:
    name: express-raw
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: express-raw
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-morojs-validation:
    name: morojs-validation
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: morojs-validation
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-morojs-raw:
    name: morojs-raw
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: morojs-raw
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-kito-validation:
    name: kito-validation
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: kito-validation
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-kito-raw:
    name: kito-raw
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: kito-raw
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-hanami-api-validation:
    name: hanami-api-validation
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: hanami-api-validation
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-hanami-api-raw:
    name: hanami-api-raw
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: hanami-api-raw
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-roda-validation:
    name: roda-validation
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: roda-validation
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-roda-raw:
    name: roda-raw
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: roda-raw
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-phalcon-validation:
    name: phalcon-validation
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: phalcon-validation
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-phalcon-raw:
    name: phalcon-raw
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: phalcon-raw
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-spikard-php-validation:
    name: spikard-php-validation
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: spikard-php-validation
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-spikard-php-raw:
    name: spikard-php-raw
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: spikard-php-raw
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}

  bench-trongate-raw:
    name: trongate-raw
    needs: build-harness
    runs-on: ubuntu-latest
    timeout-minutes: 45
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/download-artifact@v7
        with:
          name: benchmark-harness
          path: ~/.cargo/bin
      - run: chmod +x ~/.cargo/bin/benchmark-harness
      - uses: ./.github/actions/benchmark-framework
        with:
          framework: trongate-raw
          suite: ${{ inputs.suite || 'all' }}
          duration: ${{ inputs.duration || '30' }}
          concurrency: ${{ inputs.concurrency || '100' }}
